<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="pt">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Arrumar Dados DISA • sismar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Montserrat-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Lato-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Arrumar Dados DISA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sismar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Referência</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-artigos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Artigos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-artigos">
<li><a class="dropdown-item" href="../articles/export-sisma.html">Exportar dados SISMA</a></li>
    <li><a class="dropdown-item" href="../articles/tidy_sop.html">Arrumar dados SISMA</a></li>
    <li><a class="dropdown-item" href="../articles/tidy-disa.html">Arrumar dados DISA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-outro" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Outro</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-outro">
<li><a class="external-link dropdown-item" href="https://sisma.misau.gov.mz/prod/dhis-web-commons/security/login.action">Portal SISMA</a></li>
    <li><a class="external-link dropdown-item" href="https://helpdeskmoz.sis.org.mz/portal/pt/kb/sesp-epts/documenta%C3%A7%C3%A3o-de-desenvolvimento/requisitos-do-sistema-especifica%C3%A7%C3%B5es">Elementos de Dados sismar</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/usaid-mozambique/sismar"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Arrumar Dados DISA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/usaid-mozambique/sismar/blob/master/vignettes/tidy-disa.Rmd" class="external-link"><code>vignettes/tidy-disa.Rmd</code></a></small>
      <div class="d-none name"><code>tidy-disa.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="abrir-o-rstudio-e-carregar-os-pacotes">Abrir o RStudio e carregar os pacotes<a class="anchor" aria-label="anchor" href="#abrir-o-rstudio-e-carregar-os-pacotes"></a>
</h2>
<p>Se ainda não o fez, abra uma nova sessão de trabalho no RStudio. Como
habitualmente, começaremos o nosso trabalho criando um novo script R
(File -&gt; New File -&gt; R script). Também vamos carregar os
principais pacotes R necessários para arrumar os dados tabulares do
DISA. O Tidyverse é o nosso fiel e polivalente “canivete suíço” de
programação de ciência de dados em R. O pacote sismar permite-nos
arrumar os dados exportados dos sistemas de informação de saúde do
MISAU, incluindo o DISA. O pacote glue permite-nos combinar e utilizar
valores de cadeia de caracteres no código.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usaid-mozambique.github.io/sismar/">sismar</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="definir-variáveis-globais">Definir variáveis globais<a class="anchor" aria-label="anchor" href="#definir-vari%C3%A1veis-globais"></a>
</h2>
<p>Antes de processarmos os nossos dados de carga viral DISA, vamos
definir alguns valores no ambiente global do R para que possamos mais
tarde passá-los para a nossa função sismar. Primeiro, defina um valor
para o caminho para a exportação .xlsx da carga viral DISA do OpenLDR
guardada na sua máquina local. Defina um segundo valor para o mês da
exportação da carga viral DISA do sistema OpenLDR.</p>
<p>Tenha em atenção que a data do mês tem de ser definida no formato
%Y-%m-%d (“YYYY-MM-DD”). Embora não existam restrições quanto à
definição do dia exato da cadeia de datas, é melhor ser consistente se
estiver a arrumar e a compilar envios ao longo de vários meses. Por
exemplo, se estivermos a definir o dia como “01” no nosso processamento
dos dados DISA de maio, também o devemos definir como “01” no nosso
processamento de junho.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_disa_cv</span> <span class="op">&lt;-</span> <span class="st">"Data/Relatorio Mensal de Carga Viral Junho 2024.xlsx"</span></span>
<span><span class="va">month_input</span> <span class="op">&lt;-</span> <span class="st">"2024-06-20"</span></span>
<span></span>
<span><span class="va">path_disa_cv</span></span>
<span><span class="co">#&gt; [1] "Data/Relatorio Mensal de Carga Viral Junho 2024.xlsx"</span></span>
<span><span class="va">month_input</span></span>
<span><span class="co">#&gt; [1] "2024-06-20"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="arrumar-os-dados-mensais-de-carga-viral-disa">Arrumar os dados mensais de carga viral DISA<a class="anchor" aria-label="anchor" href="#arrumar-os-dados-mensais-de-carga-viral-disa"></a>
</h2>
<p>Acredita que já fizemos o trabalho árduo de processar o nosso
conjunto mensal de dados de carga viral DISA? Tudo o que precisamos de
fazer agora é escrever uma única linha de código para chamar a função
<code>process_disa_cv</code> do sismar com os argumentos que já
definimos no nosso ambiente global e temos os nossos dados de carga
viral prontos para análise!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_disa_cv.html">process_disa_cv</a></span><span class="op">(</span><span class="va">path_disa_cv</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gravar-dados-mensais-no-disco">Gravar dados mensais no disco<a class="anchor" aria-label="anchor" href="#gravar-dados-mensais-no-disco"></a>
</h2>
<p>É provável que queira gravar o seu conjunto de dados mensais
processados no disco. Isto será útil se (ou melhor, “quando”) decidir
analisar vários meses de dados DISA em conjunto. Podemos guardar
ficheiros .csv para o disco facilmente usando <code>write_csv</code> do
pacote Tidyverse readr. Tudo o que fazemos é chamar
<code>write_csv</code> e passar o nosso objeto de dados “df” juntamente
com a informação de ligação ao ficheiro (localização e nome do .csv que
guardamos no disco).</p>
<p>É de notar que no trecho de código abaixo também conseguimos aplicar
um truque útil! Usámos o pacote glue para acrescentar automaticamente um
sufixo de período ao nome do ficheiro .csv que guardámos! Isto irá
garantir que todos os meses não substituímos os ficheiros dos meses
anteriores e que acabamos com um conjunto completo de ficheiros mensais
com um nome único para compilar em conjunto! É inteligente a forma como
podemos incorporar funções noutras funções para as tornar mais
poderosas, não é?!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">write_csv</span>(df, <span class="at">file =</span> <span class="fu">glue</span>(<span class="st">"Data/processed/disa_vl_{month_input}"</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compilar-dados-mensais">Compilar dados mensais<a class="anchor" aria-label="anchor" href="#compilar-dados-mensais"></a>
</h2>
<p>Para juntar os nossos ficheiros mensais guardados, vamos aumentar o
nível de dificuldade utilizando uma expressão regular R e chamando uma
função purrr do Tidyverse chamada “map” que nos ajuda a iterar tarefas
(neste caso, a tarefa de ler um ficheiro .csv). No final do trecho de
código, usaremos a função “reduce” para juntar os nossos ficheiros
.csv.</p>
<p>A linha de código mais opaca do trecho começa com “list.files”. É
aqui que pedimos efetivamente ao R para fazer um inventário dos nomes
completos dos ficheiros na pasta onde guardámos os nossos dados DISA
processados mensalmente. O argumento “pattern” permite-nos colocar
parâmetros à volta do que inventariamos. O símbolo “^” seguido de
“disa_vl_” garante que apenas os ficheiros que começam por “disa_vl_”
serão incluídos no nosso conjunto de dados compilado.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_compiled</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"Data/processed/"</span>, pattern <span class="op">=</span> <span class="st">"^disa_vl_"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="fu">read_csv</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">reduce</span><span class="op">(</span><span class="va">rbind</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="celebre-e-analise-o-seu-trabalho">Celebre (e analise) o seu trabalho!<a class="anchor" aria-label="anchor" href="#celebre-e-analise-o-seu-trabalho"></a>
</h2>
<p>Fizemos um bom trabalho aqui, por isso, reserve um momento para dar
uma palmadinha nas costas! No entanto, não dê palmadinhas por muito
tempo, porque agora começa o trabalho ainda mais divertido de explorar
os dados e gerar percepções! Boa análise!</p>
<hr>
<p><em>Disclaimer: The findings, interpretation, and conclusions
expressed herein are those of the authors and do not necessarily reflect
the views of United States Agency for International Development. All
errors remain our own.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joe Lara, Emilton Cumbana, Karishma Srikanth, Kirstin Lyon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
